name: cixis fayli Links

on:
  schedule:
    - cron: '*/5 * * * *'  # HÉ™r 5 dÉ™qiqÉ™dÉ™n bir (istÉ™sÉ™n 180 da qoya bilÉ™rsÉ™n)
  workflow_dispatch:

jobs:
  extract:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4  # ğŸ‘ˆ v4 daha yaxÅŸÄ±dÄ±r

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests  # ğŸ‘ˆ requirements.txt yoxdursa, sadÉ™cÉ™ requests

      - name: Run extract.py (goals.py)
        run: python goals.py  # ğŸ‘ˆ sÉ™n goals.py istifadÉ™ edirsÉ™n

      - name: Commit and Push if Changed
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # ğŸ‘ˆ bu daha etibarlÄ±dÄ±r
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

          # ğŸ‘‡ ÆvvÉ™lki mÉ™lumatlarÄ± GitdÉ™n sil â€” hata versÉ™ dÉ™ davam et
          git rm -rf channels_files/ 2>/dev/null || echo "ğŸ—‘ï¸ channels_files/ GitdÉ™ tapÄ±lmadÄ± â€” davam edilir..."

          # ğŸ‘‡ Yeni dosyalarÄ± É™lavÉ™ et
          git add -A

          # ğŸ‘‡ DÉ™yiÅŸiklik varsa commit et, yoxsa keÃ§
          if git diff --cached --quiet; then
            echo "âœ… HeÃ§ bir dÉ™yiÅŸiklik yoxdur â€” push edilmir."
          else
            git commit -m "ğŸ” Updated m3u8 files"
            git pull --rebase origin main || echo "ğŸ”„ Pull uÄŸursuz â€” push davam edir..."
            git push https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }}.git HEAD:main
            echo "âœ… YenilÉ™mÉ™ uÄŸurla push edildi!"
          fi
